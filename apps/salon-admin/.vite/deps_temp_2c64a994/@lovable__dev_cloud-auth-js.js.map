{
  "version": 3,
  "sources": ["../../../../node_modules/.pnpm/@lovable.dev+cloud-auth-js@0.0.2/node_modules/@lovable.dev/cloud-auth-js/dist/index.js"],
  "sourcesContent": ["// src/auth.ts\nvar EXPECTED_MESSAGE_TYPE = \"authorization_response\";\nvar DEFAULT_OAUTH_BROKER_URL = \"/~oauth/initiate\";\nvar DEFAULT_SUPPORTED_OAUTH_ORIGINS = [\"https://oauth.lovable.app\"];\nfunction startWebMessageListener(supportedOrigins) {\n  let resolvePromise;\n  const promise = new Promise((resolve) => {\n    resolvePromise = resolve;\n  });\n  const callback = (e) => {\n    const isValidOrigin = supportedOrigins.some((origin) => e.origin === origin);\n    if (!isValidOrigin) {\n      return;\n    }\n    const data = e.data;\n    if (!data || typeof data !== \"object\") {\n      return;\n    }\n    if (data.type !== EXPECTED_MESSAGE_TYPE) {\n      return;\n    }\n    resolvePromise(data.response);\n  };\n  const cleanup = () => {\n    window.removeEventListener(\"message\", callback);\n  };\n  window.addEventListener(\"message\", callback);\n  return {\n    cleanup,\n    messagePromise: promise\n  };\n}\nfunction getPopupDimensions(isInIframe) {\n  const hasBrowserPosition = window.screenX !== 0 || window.screenY !== 0 || !isInIframe;\n  const width = hasBrowserPosition ? window.outerWidth * 0.5 : window.screen.width * 0.5;\n  const height = hasBrowserPosition ? window.outerHeight * 0.5 : window.screen.height * 0.5;\n  const left = hasBrowserPosition ? window.screenX + (window.outerWidth - width) / 2 : (window.screen.width - width) / 2;\n  const top = hasBrowserPosition ? window.screenY + (window.outerHeight - height) / 2 : (window.screen.height - height) / 2;\n  return { width, height, left, top };\n}\nfunction generateState() {\n  if (typeof crypto !== \"undefined\" && crypto.getRandomValues) {\n    return [...crypto.getRandomValues(new Uint8Array(16))].map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n  }\n  return Math.random().toString(36).substring(2) + Date.now().toString(36);\n}\nfunction createAuth(config = {}) {\n  const oauthBrokerUrl = config.oauthBrokerUrl ?? DEFAULT_OAUTH_BROKER_URL;\n  const supportedOAuthOrigins = config.supportedOAuthOrigins ?? DEFAULT_SUPPORTED_OAUTH_ORIGINS;\n  async function signInWithOAuth(provider, opts = {}) {\n    let isInIframe = false;\n    try {\n      isInIframe = window.self !== window.top;\n    } catch {\n      isInIframe = true;\n    }\n    const state = generateState();\n    const redirectUri = opts.redirect_uri ?? window.location.origin;\n    const params = new URLSearchParams({\n      provider,\n      redirect_uri: redirectUri,\n      state,\n      ...opts.extraParams\n    });\n    if (!isInIframe) {\n      window.location.href = `${oauthBrokerUrl}?${params.toString()}`;\n      return { error: null, redirected: true };\n    }\n    params.set(\"response_mode\", \"web_message\");\n    const url = `${oauthBrokerUrl}?${params.toString()}`;\n    const { messagePromise, cleanup } = startWebMessageListener(supportedOAuthOrigins);\n    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n    let popup;\n    if (isMobile) {\n      popup = window.open(url, \"_blank\");\n    } else {\n      const { width, height, left, top } = getPopupDimensions(isInIframe);\n      popup = window.open(url, \"oauth\", `width=${width},height=${height},left=${left},top=${top}`);\n    }\n    if (!popup) {\n      cleanup();\n      return { error: new Error(\"Popup was blocked\") };\n    }\n    let popupCheckInterval;\n    const popupClosedPromise = new Promise((_, reject) => {\n      popupCheckInterval = setInterval(() => {\n        if (popup.closed) {\n          clearInterval(popupCheckInterval);\n          reject(new Error(\"Sign in was cancelled\"));\n        }\n      }, 500);\n    });\n    try {\n      const data = await Promise.race([messagePromise, popupClosedPromise]);\n      if (data.error) {\n        if (data.error === \"legacy_flow\") {\n          return {\n            error: new Error(\n              \"This flow is not supported in Preview mode. Please open the app in a new tab to sign in.\"\n            )\n          };\n        }\n        return {\n          error: new Error(data.error_description ?? \"Sign in failed\")\n        };\n      }\n      if (data.state !== state) {\n        return { error: new Error(\"State is invalid\") };\n      }\n      if (!data.access_token || !data.refresh_token) {\n        return { error: new Error(\"No tokens received\") };\n      }\n      return {\n        tokens: {\n          access_token: data.access_token,\n          refresh_token: data.refresh_token\n        },\n        error: null\n      };\n    } catch (error) {\n      return {\n        error: error instanceof Error ? error : new Error(String(error))\n      };\n    } finally {\n      clearInterval(popupCheckInterval);\n      cleanup();\n      popup?.close();\n    }\n  }\n  return {\n    signInWithOAuth\n  };\n}\n\n// src/index.ts\nfunction createLovableAuth(config) {\n  return createAuth(config);\n}\nexport {\n  createLovableAuth\n};\n"],
  "mappings": "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",
  "names": []
}
